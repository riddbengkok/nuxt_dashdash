import{r as a,q as y,K as A,j as T,O as x,P as u}from"./C_QB8wpj.js";const E=window.setInterval,b=()=>{const c=a(null),t=a(!0),s=a(null),g=a(null),r=a(!1),{$firebase:n}=y(),f=A(),p=f.public.tokenCheckInterval||5*60*1e3,d=f.public.tokenExpiryWarning||10*60*1e3,h=f.public.tokenExpiryThreshold||5*60*1e3;console.log("Token Settings:",{checkInterval:`${p/1e3/60} minutes`,warningTime:`${d/1e3/60} minutes`,expiryThreshold:`${h/1e3/60} minutes`});const i=async()=>{if(n&&n.auth.currentUser)try{const e=await n.auth.currentUser.getIdTokenResult(),o=new Date(e.expirationTime),l=o-new Date;return g.value=o,r.value=l<=h,console.log("Token Info:",{tokenId:e.token.slice(0,20)+"...",issuedAt:new Date(e.issuedAtTime).toLocaleString(),expiresAt:o.toLocaleString(),isExpired:r.value,timeUntilExpiry:Math.floor(l/1e3/60)+" minutes",warningThreshold:Math.floor(d/1e3/60)+" minutes",expiryThreshold:Math.floor(h/1e3/60)+" minutes"}),l<=d&&l>h&&console.warn(`Token will expire in ${Math.floor(l/1e3/60)} minutes`),r.value&&(console.warn("Token is expired, attempting refresh..."),await k()),e}catch(e){return console.error("Error checking token:",e),null}return null},k=async()=>{if(n&&n.auth.currentUser)try{console.log("Refreshing token...");const e=await n.auth.currentUser.getIdToken(!0);return console.log("Token refreshed successfully"),await i(),e}catch(e){throw console.error("Error refreshing token:",e),await w(),e}};T(()=>{if(console.log("useAuth: Starting auth state monitoring"),n){console.log("useAuth: Firebase plugin found");const e=n.onAuthStateChanged(async o=>{if(console.log("useAuth: Auth state changed:",o),o){console.log("useAuth: User signed in:",{uid:o.uid,email:o.email,displayName:o.displayName}),c.value=o,await i();const v=E(async()=>{c.value?await i():clearInterval(v)},p)}else console.log("useAuth: User signed out"),c.value=null,g.value=null,r.value=!1;t.value=!1});x(()=>{console.log("useAuth: Cleaning up auth listener"),e()})}else console.error("useAuth: Firebase plugin not found"),t.value=!1,s.value="Firebase not initialized";setTimeout(()=>{t.value&&(console.warn("useAuth: Loading timeout - forcing loading to false"),t.value=!1,s.value="Authentication timeout - please refresh the page")},1e4)});const m=async()=>{try{if(t.value=!0,s.value=null,!n)throw new Error("Firebase not initialized");console.log("useAuth: Starting Google sign-in...");const e=await n.signInWithGoogle();return console.log("useAuth: Sign-in successful:",e),await i(),e}catch(e){throw console.error("useAuth: Sign-in error:",e),s.value=e.message,e}finally{t.value=!1}},w=async()=>{try{if(!n)throw new Error("Firebase not initialized");console.log("useAuth: Starting sign out..."),await n.signOut(),console.log("useAuth: Sign out successful"),g.value=null,r.value=!1}catch(e){throw console.error("useAuth: Sign out error:",e),s.value=e.message,e}};return{user:u(c),loading:u(t),error:u(s),tokenExpiry:u(g),isTokenExpired:u(r),signInWithGoogle:m,signOut:w,checkTokenExpiration:i,refreshToken:k}};export{b as u};
